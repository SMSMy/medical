<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CT Scan Viewer - Ø¹Ø§Ø±Ø¶ Ø§Ù„Ø£Ø´Ø¹Ø© Ø§Ù„Ù…Ù‚Ø·Ø¹ÙŠØ©</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #667eea;
        --primary-dark: #5a67d8;
        --secondary: #11998e;
        --dark-bg: #1a1a2e;
        --darker-bg: #16213e;
        --card-bg: rgba(255, 255, 255, 0.08);
        --text-light: #ffffff;
        --text-muted: #adb5bd;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Tajawal", sans-serif;
        background: linear-gradient(
          135deg,
          var(--dark-bg) 0%,
          var(--darker-bg) 100%
        );
        color: var(--text-light);
        min-height: 100vh;
        line-height: 1.6;
      }

      .header {
        background: linear-gradient(135deg, var(--primary) 0%, #764ba2 100%);
        padding: 2rem 1rem;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }

      .header h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }
      .header p {
        opacity: 0.9;
        font-size: 1rem;
      }

      .loading {
        text-align: center;
        padding: 3rem;
        font-size: 1.5rem;
      }

      .loading .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid var(--secondary);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .alert-box {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        margin: 1rem;
        padding: 1.5rem;
        border-radius: 15px;
        text-align: center;
        font-size: 1.1rem;
        box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
      }

      .alert-box .icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }

      .regions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        padding: 1.5rem;
        max-width: 1400px;
        margin: 0 auto;
      }

      .region-card {
        background: var(--card-bg);
        border-radius: 20px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: transform 0.3s, box-shadow 0.3s;
        cursor: pointer;
      }

      .region-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
      }

      .region-card .preview {
        width: 100%;
        height: 250px;
        background: #000;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
      }

      .region-card .preview img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }

      .region-card .overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(102, 126, 234, 0.8);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .region-card:hover .overlay {
        opacity: 1;
      }

      .overlay .icon {
        font-size: 3rem;
        margin-bottom: 0.5rem;
      }
      .overlay .text {
        font-size: 1.1rem;
        text-align: center;
        padding: 0 1rem;
      }

      .region-card .info {
        padding: 1.5rem;
        background: linear-gradient(135deg, var(--primary) 0%, #764ba2 100%);
      }

      .region-card .info h3 {
        font-size: 1.3rem;
        margin-bottom: 0.5rem;
      }
      .region-card .info .count {
        opacity: 0.9;
        font-size: 1rem;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.98);
        z-index: 2000;
        flex-direction: column;
      }

      .modal.active {
        display: flex;
      }

      .modal-header {
        background: var(--darker-bg);
        padding: 1rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .modal-header h2 {
        font-size: 1.3rem;
        color: #38ef7d;
      }

      .modal-close {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        border: none;
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-size: 1.5rem;
        cursor: pointer;
        transition: transform 0.3s;
      }

      .modal-close:hover {
        transform: scale(1.1);
      }

      .modal-body {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
      }

      .modal-body img {
        max-width: 90%;
        max-height: 80vh;
        object-fit: contain;
      }

      .modal-instructions {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(102, 126, 234, 0.95);
        padding: 2rem 3rem;
        border-radius: 20px;
        text-align: center;
        z-index: 10;
        animation: fadeIn 0.5s;
      }

      .modal-instructions.hidden {
        display: none;
      }
      .modal-instructions .icon {
        font-size: 4rem;
        margin-bottom: 1rem;
      }
      .modal-instructions h3 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }
      .modal-instructions p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.9);
        }
        to {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
      }

      .modal-footer {
        background: var(--darker-bg);
        padding: 1.5rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .slider-container {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .slider-container input[type="range"] {
        flex: 1;
        height: 10px;
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.2);
        appearance: none;
        cursor: pointer;
      }

      .slider-container input[type="range"]::-webkit-slider-thumb {
        appearance: none;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--secondary) 0%, #38ef7d 100%);
        cursor: pointer;
      }

      .slice-info {
        text-align: center;
        font-size: 1.2rem;
        font-weight: 500;
      }
      .slice-info .current {
        color: #38ef7d;
        font-size: 2rem;
        font-weight: 700;
      }

      .nav-buttons {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 1rem;
      }

      .nav-btn {
        background: linear-gradient(135deg, var(--primary) 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 0.8rem 2rem;
        border-radius: 25px;
        font-size: 1rem;
        font-family: "Tajawal", sans-serif;
        cursor: pointer;
        transition: transform 0.3s;
      }

      .nav-btn:hover {
        transform: scale(1.05);
      }

      .back-link {
        display: block;
        text-align: center;
        padding: 1.5rem;
        color: var(--text-muted);
        text-decoration: none;
        font-size: 1rem;
      }

      .back-link:hover {
        color: var(--text-light);
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 1.5rem;
        }
        .regions-grid {
          grid-template-columns: 1fr;
        }
        .modal-instructions {
          padding: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <h1>ğŸ”¬ Ø¹Ø§Ø±Ø¶ Ø§Ù„Ø£Ø´Ø¹Ø© Ø§Ù„Ù…Ù‚Ø·Ø¹ÙŠØ© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</h1>
      <p>CT Scan Interactive Viewer</p>
    </header>

    <div class="alert-box">
      <div class="icon">ğŸ‘†</div>
      <div>
        Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù†Ø·Ù‚Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª â€¢ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø¹Ù„Ù‰ ÙˆØ§Ù„Ø£Ø³ÙÙ„
        Ù„Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙˆØ±
      </div>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <div>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    </div>

    <div class="regions-grid" id="regionsGrid"></div>

    <a href="index.html" class="back-link">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø§Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„</a>

    <!-- Modal -->
    <div class="modal" id="viewerModal">
      <div class="modal-header">
        <h2 id="modalTitle">Ø§Ù„Ø±Ø£Ø³</h2>
        <button class="modal-close" onclick="closeModal()">âœ•</button>
      </div>
      <div class="modal-body" id="modalBody">
        <div class="modal-instructions" id="modalInstructions">
          <div class="icon">ğŸ–±ï¸</div>
          <h3>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h3>
          <p>ğŸ”¼ Ù…Ø±Ø± Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</p>
          <p>ğŸ”½ Ù…Ø±Ø± Ù„Ù„Ø£Ø³ÙÙ„ Ù„Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</p>
          <p>Ø§Ø¶ØºØ· ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ù„Ù„Ø¨Ø¯Ø¡</p>
        </div>
        <img id="sliceImage" src="" alt="CT Slice" />
      </div>
      <div class="modal-footer">
        <div class="slider-container">
          <span>1</span>
          <input
            type="range"
            id="sliceSlider"
            min="0"
            value="0"
            oninput="goToSlice(this.value)"
          />
          <span id="maxSlice">100</span>
        </div>
        <div class="slice-info">
          Ø§Ù„Ø·Ø¨Ù‚Ø© <span class="current" id="currentSlice">1</span> Ù…Ù†
          <span id="totalSlices">100</span>
        </div>
        <div class="nav-buttons">
          <button class="nav-btn" onclick="prevSlice()">â—€ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</button>
          <button class="nav-btn" onclick="nextSlice()">Ø§Ù„ØªØ§Ù„ÙŠØ© â–¶</button>
        </div>
      </div>
    </div>

    <script>
      let regions = {};
      let currentRegion = null;
      let currentRegionKey = null;
      let currentIndex = 0;
      let instructionsShown = true;

      // Load regions data from JSON
      async function loadRegions() {
        try {
          const response = await fetch("regions_data.json");
          const data = await response.json();
          regions = data;
          buildRegionsGrid();
          document.getElementById("loading").style.display = "none";

          // Check for hash in URL to open specific region
          if (window.location.hash) {
            const regionKey = window.location.hash.substring(1);
            if (regions[regionKey]) {
              openViewer(regionKey);
            }
          }
        } catch (error) {
          console.error("Error loading regions:", error);
          document.getElementById("loading").innerHTML =
            '<div style="color: #dc3545;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
        }
      }

      // Handle hash changes
      window.addEventListener("hashchange", function () {
        if (window.location.hash) {
          const regionKey = window.location.hash.substring(1);
          if (regions[regionKey]) {
            openViewer(regionKey);
          }
        } else {
          closeModal();
        }
      });

      function buildRegionsGrid() {
        const grid = document.getElementById("regionsGrid");
        grid.innerHTML = "";

        const regionOrder = [
          "HEAD",
          "CHEST",
          "ABDOMEN",
          "NECK",
          "SPINE",
          "PELVIS",
          "EXTREMITY",
          "TIBIA",
        ];

        for (const key of regionOrder) {
          if (!regions[key]) continue;
          const region = regions[key];
          const card = document.createElement("div");
          card.className = "region-card";
          card.onclick = () => {
            window.location.hash = key;
          };

          const midIndex = Math.floor(region.images.length / 2);
          const previewImg = key + "/" + region.images[midIndex];

          card.innerHTML = `
                    <div class="preview">
                        <img src="${previewImg}" alt="${region.name}" onerror="this.src='${key}/${region.images[0]}'">
                        <div class="overlay">
                            <div class="icon">ğŸ‘†</div>
                            <div class="text">Ø§Ø¶ØºØ· Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªØ¹Ø±Ø§Ø¶<br>ØªØµÙØ­ ${region.images.length} Ø·Ø¨Ù‚Ø©</div>
                        </div>
                    </div>
                    <div class="info">
                        <h3>${region.icon} ${region.name}</h3>
                        <div class="count">${region.images.length} ØµÙˆØ±Ø© / Ø·Ø¨Ù‚Ø©</div>
                    </div>
                `;

          grid.appendChild(card);
        }
      }

      function openViewer(regionKey) {
        currentRegion = regions[regionKey];
        currentRegionKey = regionKey;
        currentIndex = 0;
        instructionsShown = true;

        document.getElementById("modalTitle").textContent =
          currentRegion.icon + " " + currentRegion.name;
        document.getElementById("sliceSlider").max =
          currentRegion.images.length - 1;
        document.getElementById("maxSlice").textContent =
          currentRegion.images.length;
        document.getElementById("totalSlices").textContent =
          currentRegion.images.length;
        document.getElementById("modalInstructions").classList.remove("hidden");

        updateImage();
        document.getElementById("viewerModal").classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeModal() {
        document.getElementById("viewerModal").classList.remove("active");
        document.body.style.overflow = "";
        currentRegion = null;
        // removing hash without scrolling
        history.pushState(
          "",
          document.title,
          window.location.pathname + window.location.search
        );
      }

      function updateImage() {
        if (!currentRegion) return;
        const imgSrc =
          currentRegionKey + "/" + currentRegion.images[currentIndex];
        document.getElementById("sliceImage").src = imgSrc;
        document.getElementById("currentSlice").textContent = currentIndex + 1;
        document.getElementById("sliceSlider").value = currentIndex;
      }

      function nextSlice() {
        if (currentIndex < currentRegion.images.length - 1) {
          currentIndex++;
          updateImage();
        }
      }

      function prevSlice() {
        if (currentIndex > 0) {
          currentIndex--;
          updateImage();
        }
      }

      function goToSlice(index) {
        currentIndex = parseInt(index);
        updateImage();
      }

      document
        .getElementById("modalBody")
        .addEventListener("click", function () {
          if (instructionsShown) {
            document
              .getElementById("modalInstructions")
              .classList.add("hidden");
            instructionsShown = false;
          }
        });

      document.getElementById("modalBody").addEventListener(
        "wheel",
        function (e) {
          e.preventDefault();
          if (instructionsShown) {
            document
              .getElementById("modalInstructions")
              .classList.add("hidden");
            instructionsShown = false;
          }
          if (e.deltaY > 0) nextSlice();
          else prevSlice();
        },
        { passive: false }
      );

      document.addEventListener("keydown", function (e) {
        if (!currentRegion) return;
        if (e.key === "Escape") closeModal();
        else if (e.key === "ArrowDown" || e.key === "ArrowRight") nextSlice();
        else if (e.key === "ArrowUp" || e.key === "ArrowLeft") prevSlice();
        else if (e.key === "Home") {
          currentIndex = 0;
          updateImage();
        } else if (e.key === "End") {
          currentIndex = currentRegion.images.length - 1;
          updateImage();
        }
      });

      // Initialize
      loadRegions();
    </script>
  </body>
</html>
